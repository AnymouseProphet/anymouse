\NeedsTeXFormat{LaTeX2e}
\def\fileversion{0.2}
\def\filedate{2021/07/13}
\ProvidesPackage{anymouse}[\filedate\space v\fileversion]

\message{`anymouse' v\fileversion, \filedate\space Loads fonts and macros for Anymouse Prophet publications (anymouseprophet)}

\RequirePackage{ifthen}
\RequirePackage{siunitx}
\RequirePackage{letltxmacro}
\RequirePackage[table,usenames,dvipsnames]{xcolor}
\RequirePackage{soul}
% default options
\newcommand{\ampedition}{canonical}
\newcommand{\ampcolor}{yes}
\newcommand{\ampmonofont}{spacemono}
\newcommand{\mathfonts}{no}
\newcommand{\replacefonts}{no}
\newcommand{\tipafonts}{no}
\newcommand{\lgrgreek}{no}
%
%
\DeclareOption{canonical}{
  \renewcommand{\ampedition}{canonical}
}
\DeclareOption{printhouse}{
  \renewcommand{\ampedition}{printhouse}
}
\DeclareOption{reduced}{
  \renewcommand{\ampedition}{reduced}
}
\DeclareOption{grayscale}{
  \renewcommand{\ampedition}{grayscale}
  \renewcommand{\ampcolor}{no}
}
\DeclareOption{dyslexia}{
  \renewcommand{\ampedition}{dyslexia}
  \renewcommand{\ampcolor}{no}
}
%
\DeclareOption{courier}{\renewcommand{\ampmonofont}{courier}}
\DeclareOption{spacemono}{\renewcommand{\ampmonofont}{spacemono}}% currently default
\DeclareOption{math}{\renewcommand{\mathfonts}{yes}}
\DeclareOption{tipa}{
  \renewcommand{\tipafonts}{yes}
  \renewcommand{\replacefonts}{yes}
}
\DeclareOption{lgr}{
  \renewcommand{\lgrgreek}{txr}
  \renewcommand{\replacefonts}{yes}
}
\DeclareOption{txr}{
  \renewcommand{\lgrgreek}{txr}
  \renewcommand{\replacefonts}{yes}
}
\DeclareOption{porson}{
  \renewcommand{\lgrgreek}{porson}
  \renewcommand{\replacefonts}{yes}
}
\DeclareOption{udidot}{
  \renewcommand{\lgrgreek}{udidot}
  \renewcommand{\replacefonts}{yes}
}
\DeclareOption{epigrafica}{
  \renewcommand{\lgrgreek}{epigrafica}
  \renewcommand{\replacefonts}{yes}
}
\DeclareOption{artemisia}{
  \renewcommand{\lgrgreek}{artemisia}
  \renewcommand{\replacefonts}{yes}
}
\DeclareOption*{\PackageWarning{anymouse}{Unknown ‘\CurrentOption’}}
\ProcessOptions\relax
%
%
%% printhouse edition gets ISBN on back cover, not typeset here by LaTeX
\ifthenelse{\equal{\ampedition}{printhouse}}{}{%else
  \ifthenelse{\equal{\ampedition}{reduced}}{
    \RequirePackage{ean13isbn}
  }{% use TeXGyre condensed in T1 encoding
    \RequirePackage{ampean13isbn}
  }
}
%
\ifthenelse{\equal{\ampedition}{reduced}}{
  \renewcommand{\ampmonofont}{courier}
  \ifthenelse{\equal{\mathfonts}{yes}}{
    \IfFileExists{mtpro2.sty}{}{% else
      \PackageWarning{anymouse}{MathTime Pro 2 not available, using TeX Gyre fonts}
      \renewcommand{\ampedition}{notreduced}
    }
  }{}
}{}
%
\ifthenelse{\equal{\ampmonofont}{spacemono}}{
  \IfFileExists{spacemono.sty}{}{% else
    \PackageWarning{anymouse}{Space Mono not available, using Courier for typewriter font}
    \renewcommand{\ampmonofont}{courier}
  }
}{}

% used within quote environment for historic documents
\newcommand{\ampscriptfont}{\fontfamily{qzc}\selectfont\large}
% used within footnotes and LCCN
\newcommand{\ampcondensedfont}{\fontfamily{qhv}\fontseries{mc}\selectfont}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The amssymb package has to be loaded before TeX Gyre %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\mathfonts}{yes}}{
  \RequirePackage{amssymb}
  \RequirePackage{bm}
}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Define the sans-serif and serif fonts %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\ampedition}{reduced}}{
  \renewcommand{\sfdefault}{phv}
  \renewcommand{\rmdefault}{ptm}
  \ifthenelse{\equal{\mathfonts}{yes}}{
    \RequirePackage{amsmath}
    \RequirePackage[lite]{mtpro2}
    %fix bug in mtpro2 -- see https://tex.stackexchange.com/questions/87419/conflict-between-mathtime-pro-2-refcheck-and-braces-in-text-mode
    \DeclareRobustCommand\{{\ifmmode\lbrace\else\textbraceleft\fi}
    \DeclareRobustCommand\}{\ifmmode\rbrace\else\textbraceright\fi}
  }{}
}{% else use the TeX Gyre fonts instead of PDF14
  \RequirePackage{newtxtext}
  \ifthenelse{\equal{\mathfonts}{yes}}{
    \RequirePackage{newtxmath}
  }{}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% define the monospace font %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\ampmonofont}{spacemono}}{
  \RequirePackage{spacemono}
}{% else
  \ifthenelse{\equal{\ampedition}{reduced}}{% use Courier or (Nimbus Mono L equivalent)
    \renewcommand{\ttdefault}{pcr}
  }{% else TeX Gyre-Cursor
    \renewcommand{\ttdefault}{qcr}
  }
}
% for reducing the monospace font size
\LetLtxMacro\oldttfamily\ttfamily
\DeclareRobustCommand{\ttfamily}{\oldttfamily\csname ttsize\endcsname}
\def\ttsize{\small}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Clear Sans as body font %
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\ampedition}{dyslexia}}{
  \RequirePackage[sfdefault]{ClearSans}
}{}

% Do we need font encoding substitutes?
\ifthenelse{\equal{\replacefonts}{yes}}{
  % either greek or ipa or both
  \ifthenelse{\equal{\tipafonts}{yes}}{
    \ifthenelse{\equal{\lgrgreek}{no}}{% ipa only
      \RequirePackage[T3,T1]{fontenc}
    }{% greek and ipa
      \RequirePackage[T3,LGR,T1]{fontenc}
    }
  }{%else greek only
    \RequirePackage[LGR,T1]{fontenc}
  }
  \RequirePackage{substitutefont}
}{
% likely not needed but make sure it's most recently loaded
\RequirePackage[T1]{fontenc}
}

%%%%%%%%%%%%%%%%%%%%
% the tipa package %
%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\tipafonts}{yes}}{
  \RequirePackage[noenc]{tipa}
  \ifthenelse{\equal{\ampedition}{reduced}}{}{% only needed if not using pdf14
    \substitutefont{T3}{\rmdefault}{ptm}
    \substitutefont{T3}{\sfdefault}{phv}
  }
  \ifthenelse{\equal{\ampmonofont}{spacemono}}{}{% only needed if not using spacemono
    \substitutefont{T3}{\ttdefault}{cmtt}
  }
}{}

%%%%%%%%%%%%%%%%%%%%%
% LGR Greek support %
%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\lgrgreek}{no}}{}{% only do this if not no
  \substitutefont{LGR}{\rmdefault}{\lgrgreek}
  \substitutefont{LGR}{\sfdefault}{\lgrgreek}
  \newcommand{\textgreek}[1]{\begingroup\fontencoding{LGR}\selectfont#1\endgroup}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% define type of highlight %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\ampcolor}{yes}}{}{%else
  \renewcommand*{\hl}{\ul}
}

% reset to reduced
\ifthenelse{\equal{\ampedition}{notreduced}}{
  \renewcommand{\ampedition}{reduced}
}
%load misc macros
\RequirePackage{ampmisc}
\endinput
