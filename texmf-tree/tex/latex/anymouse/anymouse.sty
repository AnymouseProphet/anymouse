\NeedsTeXFormat{LaTeX2e}
\def\fileversion{0.3}
\def\filedate{2021/07/15}
\ProvidesPackage{anymouse}[\filedate\space v\fileversion]

\message{`anymouse' v\fileversion, \filedate\space Loads fonts and macros for Pipfrosch Press publications (anymouseprophet)}

\RequirePackage[utf8]{inputenc}
\RequirePackage{keyval}
\RequirePackage{ampean13isbn}
\RequirePackage{ifthen}
\RequirePackage{siunitx}
\RequirePackage{letltxmacro}
\RequirePackage[table,usenames,dvipsnames]{xcolor}
\RequirePackage{soul}
\RequirePackage{afterpage}
% default options
\newcommand{\ampedition}{canonical}
\newcommand{\ampcolor}{yes}
\newcommand{\mathfonts}{no}
\newcommand{\replacefonts}{no}
\newcommand{\tipafonts}{no}
\newcommand{\lgrgreek}{no}
%
\define@key{amp}{edition}[canonical]{\renewcommand{\ampedition}{#1}}
\define@key{amp}{math}[yes]{\renewcommand{\mathfonts}{#1}}
\define@key{amp}{greek}[txr]{\renewcommand{\lgrgreek}{#1}}
\define@key{amp}{tipa}[yes]{\renewcommand{\tipafonts}{#1}}
\ProcessKeyvalOptions{amp}
% post process
\ifthenelse{\equal{\tipafonts}{no}}{}{%
  \renewcommand{\tipafonts}{yes}
  \renewcommand{\replacefonts}{yes}
}
\ifthenelse{\equal{\mathfonts}{no}}{}{%
  \renewcommand{\mathfonts}{yes}
}
\ifthenelse{\equal{\ampedition}{canonical}}{}{%change defaults as needed
  \ifthenelse{\equal{\ampedition}{reduced}}{
    \ifthenelse{\equal{\mathfonts}{yes}}{
      \IfFileExists{mtpro2.sty}{}{% else
        \PackageWarning{anymouse}{MathTime Pro 2 not available, using TeX Gyre fonts}
        \renewcommand{\ampedition}{notreduced}
      }
    }{}
  }{}
  \ifthenelse{\equal{\ampedition}{grayscale}}{
    \renewcommand{\ampcolor}{no}
  }{}
  \ifthenelse{\equal{\ampedition}{greyscale}}{
    \renewcommand{\ampcolor}{no}
  }{}
  \ifthenelse{\equal{\ampedition}{sans}}{
    \renewcommand{\ampcolor}{no}
  }{}
}
\ifthenelse{\equal{\lgrgreek}{no}}{}{%
  \newcommand{\lgrtestfile}{lgr\lgrgreek .fd}
  \IfFileExists{\lgrtestfile}{}{% else
    \PackageWarning{anymouse}{LGR encoding definition \lgrtestfile{} not found, using txr font instead}
    \renewcommand{\lgrgreek}{txr}
  }
  \renewcommand{\replacefonts}{yes}
}

% used within quote environment for historic documents
\newcommand{\ampscriptfont}{\fontfamily{qzc}\selectfont\large}
% used within footnotes and LCCN
\newcommand{\ampcondensedfont}{\fontfamily{qhv}\fontseries{mc}\selectfont}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The amssymb package has to be loaded before TeX Gyre %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\mathfonts}{yes}}{
  \RequirePackage{amssymb}
  \RequirePackage{bm}
}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Define the sans-serif, serif fonts, monospace fonts %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\ampedition}{reduced}}{
  \renewcommand{\sfdefault}{phv}
  \renewcommand{\rmdefault}{ptm}
  \renewcommand{\ttdefault}{pcr}
  \ifthenelse{\equal{\mathfonts}{yes}}{
    \RequirePackage{amsmath}
    \RequirePackage[lite]{mtpro2}
    %fix bug in mtpro2 -- see https://tex.stackexchange.com/questions/87419/conflict-between-mathtime-pro-2-refcheck-and-braces-in-text-mode
    \DeclareRobustCommand\{{\ifmmode\lbrace\else\textbraceleft\fi}
    \DeclareRobustCommand\}{\ifmmode\rbrace\else\textbraceright\fi}
  }{}
}{% else use the TeX Gyre fonts instead of PDF14
  \RequirePackage{newtxtext}
  \ifthenelse{\equal{\mathfonts}{yes}}{
    \RequirePackage{newtxmath}
  }{}
  \RequirePackage{spacemono}
}
% for reducing the monospace font size
\LetLtxMacro\oldttfamily\ttfamily
\DeclareRobustCommand{\ttfamily}{\oldttfamily\csname ttsize\endcsname}
\def\ttsize{\small}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Special Case Clear Sans as body font %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\ampedition}{sans}}{
  \RequirePackage[sfdefault]{ClearSans}
  \RequirePackage{ragged2e}
  \setlength{\RaggedRightParindent}{\parindent}
  \let\emph\relax
  \DeclareTextFontCommand{\emph}{\bfseries}
}{}

% Do we need font encoding substitutes?
\ifthenelse{\equal{\replacefonts}{yes}}{
  % either greek or ipa or both
  \ifthenelse{\equal{\tipafonts}{yes}}{
    \ifthenelse{\equal{\lgrgreek}{no}}{% ipa only
      \RequirePackage[T3,T1]{fontenc}
    }{% greek and ipa
      \RequirePackage[T3,LGR,T1]{fontenc}
    }
  }{%else greek only
    \RequirePackage[LGR,T1]{fontenc}
  }
  \RequirePackage{substitutefont}
}{
  % likely not needed but make sure it's most recently loaded
  \RequirePackage[T1]{fontenc}
}

%%%%%%%%%%%%%%%%%%%%
% the tipa package %
%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\tipafonts}{yes}}{
  \RequirePackage[noenc]{tipa}
  \ifthenelse{\equal{\ampedition}{reduced}}{% only needed if courier is the monospace font
    \substitutefont{T3}{\ttdefault}{cmtt}
  }{% only needed if not using pdf14
    \substitutefont{T3}{\rmdefault}{ptm}
    \substitutefont{T3}{\sfdefault}{phv}
  }
}{}

%%%%%%%%%%%%%%%%%%%%%
% LGR Greek support %
%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\lgrgreek}{no}}{}{% only do this if not no
  \substitutefont{LGR}{\rmdefault}{\lgrgreek}
  \substitutefont{LGR}{\sfdefault}{\lgrgreek}
  \newcommand{\textgreek}[1]{\begingroup\fontencoding{LGR}\selectfont#1\endgroup}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% define type of highlight %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifthenelse{\equal{\ampcolor}{yes}}{}{%else
  \renewcommand*{\hl}{\ul}
}

% reset to reduced
\ifthenelse{\equal{\ampedition}{notreduced}}{
  \renewcommand{\ampedition}{reduced}
}
%load misc macros
\RequirePackage{ampmisc}
\endinput
